<html>

<head>
    <title>xCheckStudio</title>
    <link rel="stylesheet" href="CSS\Tablestyle.css" type="text/css" />
    <link rel="stylesheet" href="CSS\ViewStyle.css" type="text/css" />

    <script type="text/javascript" src="Javascripts\jquery\jquery-1.7.1.min.js"></script>

    <script type="text/javascript" src="Javascripts/hoops_web_viewer.js"></script>
    <script type="text/javascript" src="Javascripts/communicator_server_integration.js"></script>
    <script type="text/javascript" src="Javascripts/SheetJS/xlsx.js"></script>

    <script type="text/javascript" src="Javascripts/common/Example.js"></script>
    <script type="text/javascript" src="Javascripts/common/ModelTree.js"></script>
    <script type="text/javascript" src="Javascripts/common/require.js"></script>

    <script type="text/javascript" src="Javascripts\xCheckStudio\xCheckStudioInterface.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\GenericProperties.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\ComponentNodeData.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\CheckManager.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\CheckCaseManager.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\Utility.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\ComplianceCheckRules.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\CheckCaseFilesData.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\ExcelModelBrowser.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\ExcelReader.js"></script>
    <script type="text/javascript" src="Javascripts\xCheckStudio\CheckModuleStringCollection.js"></script>

    <link type="text/css" rel="stylesheet" href="Javascripts/jsgrid-1.5.3/css/jsgrid.css" />
    <link type="text/css" rel="stylesheet" href="Javascripts/jsgrid-1.5.3/css/theme.css" />
    <script type="text/javascript" src="Javascripts\jsgrid-1.5.3\dist\jsgrid.js"></script>



    <script src='configurations\dir.php'></script>
    <style>
        /* The grid: Three equal columns that floats next to each other */
        .column {
            float: left;
            text-align: center;
            width: 100%;
            font-size: 25px;
            cursor: pointer;
            color: white;
        }

        .containerTab {
            padding: 20px;
            color: white;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        /* Closable button inside the container tab */
        .closebtn {
            float: right;
            color: white;
            font-size: 35px;
            cursor: pointer;

        }

        .collapsible {
            background-color: #777;
            color: white;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
        }

        .active,
        .collapsible:hover {
            background-color: #555;
        }

        .content {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            background-color: #f1f1f1;
        }

        img.button_open {
            content: url('images/button-open.png');
            cursor: pointer;
        }

        img.button_closed {
            content: url('images/button-closed.png');
            cursor: pointer;
        }

        .scrollable {
            overflow: auto;
        }

        #divLoading
        {
            display : none;
        }
        #divLoading.show
        {
            display : block;
            position : fixed;
            z-index: 100;
            background-image : url('/images/busySpinner.gif');
            background-color:#666;
            opacity : 0.8;
            background-repeat : no-repeat;
            background-position : center;
            left : 0;
            bottom : 0;
            right : 0;
            top : 0;
        }
        #loadinggif.show
        {
            left : 50%;
            top : 50%;
            position : absolute;
            z-index : 101;
            width : 32px;
            height : 32px;
            margin-left : -16px;
            margin-top : -16px;
        }
        div.content {
        width : 1000px;
        height : 1000px;
        }

        </style>
</head>

<body>
    <div id="divLoading">
    </div>

    <table style="width: -webkit-fill-available; height:-webkit-fill-available; margin: auto; max-height: -webkit-fill-available;">
        <th colspan="2" style=" background-color: #333333; height: 10%;  text-align: center">
            <img src="images/Header.png">
        </th>
        <tr style=" text-align: center; height:20px;">
            <td colspan="2" style="border:none;">
                <!-- <iframe name="formDestination" height="100px"></iframe> -->

                <button id="checkButton" disabled="true" onclick="goToReviewModule()"> Check Datasources</button>
                <button onclick="clearData()" id="ClearButton">Clear data</button>

            </td>
        </tr>
        <tr style="height: 5%;">
            <td style="width: 50%; border:none;">
                <div class="row" style="width: 100%;">
                    <div class="column" onclick="openTab('b1');" style="background:LightSalmon ; ">
                        Source A
                    </div>
                </div>
            </td>
            <td style="width: 50%; border:none;">
                <div class="row" style="width: 100%">
                    <div class="column" onclick="openTab('b2');" style="background:lightgreen ;">
                        Source B
                    </div>
                </div>
            </td>
        </tr>
        <tr style=" text-align: center;">
            <td colspan="2" style="border:none;">
                <!-- Full-width columns: (hidden by default) -->
                <div id="b1" class="containerTab" style="display:none;background:LightSalmon; ">
                    <span onclick="this.parentElement.style.display='none'" class="closebtn">&times;</span>
                    <h2>Source A</h2>
                    <div>
                        <!-- First model tree and it's viewer -->
                        <table>
                            <tr colspan="2">
                                <form id="uploadDatasourceAForm" enctype="multipart/form-data">
                                    <div>
                                        <input id="dataSouresA" name="dataSouresName" type="file" onchange="loadDataSource(event, 'dataSouresA', 'uploadDatasourceAForm', 'viewerContainer1', 'modelTree1')"
                                            disabled />
                                    </div>
                                </form>
                            </tr>

                            <tr>
                                <td valign="top" style="border:none;">
                                    <div id="modelTree1"></div>
                                </td>
                                <td style="border:none;">
                                    <div id="viewerContainer1" class="example-canvas-small"></div>
                                </td>
                                <tr style="font-size: 12px">
                                    <td >
                                            <div id="totalComponentCount1"></div>
                                    </td>
                                </tr>
                            </tr>
                            <tr>
                                <td style="border:none;"></td>
                                <td style="border:none;">
                                    <div class="viewOrientation2">
                                        <button id="Front1" disabled>Front</button>
                                        <button id="Back1" disabled>Back</button>
                                        <button id="Top1" disabled>Top</button>
                                        <button id="Bottom1" disabled>Bottom</button>
                                        <button id="Left1" disabled>Left</button>
                                        <button id="Right1" disabled>Right</button>
                                        <button id="Iso1" disabled>Iso</button>
                                    </div>
                                </td>
                            </tr>

                            <tr>
                                <td style="border:none;">
                                </td>
                                <td style="border:none;">
                                    <label>Compliance<input id='complianceSourceACB' type='checkbox' disabled></label>
                                    <label>Check All<input id='checkAllSourceACB' type='checkbox' onclick='checkAllCBClick(this,"modelTree1")'
                                            checked disabled></label>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div id="b2" class="containerTab" style="display:none;background:LightGreen ">
                    <span onclick="this.parentElement.style.display='none'" class="closebtn">&times;</span>
                    <h2>Source B</h2>

                    <!-- second model tree and it's viewer -->
                    <table>
                        <tr colspan="2">
                            <form id="uploadDatasourceBForm" enctype="multipart/form-data">
                                <div>
                                    <input id="dataSouresB" name="dataSouresName" type="file" onchange="loadDataSource(event, 'dataSouresB', 'uploadDatasourceBForm', 'viewerContainer2', 'modelTree2')"
                                        disabled />
                                </div>
                            </form>
                        </tr>

                        <tr>
                            <td valign="top" style="border:none;">
                                <div id="modelTree2"></div>
                            </td>
                            <td style="border:none;">
                                <div id="viewerContainer2" class="example-canvas-small"></div>
                            </td>
                        </tr>
                        <tr>
                                <td >
                                        <div id="totalComponentCount2"></div>
                                </td>
                        </tr>
                        <tr></tr>
                        <tr>
                            <td style="border:none;"></td>
                            <td style="border:none;">
                                <div class="viewOrientation2">
                                    <button id="Front2" disabled>Front</button>
                                    <button id="Back2" disabled>Back</button>
                                    <button id="Top2" disabled>Top</button>
                                    <button id="Bottom2" disabled>Bottom</button>
                                    <button id="Left2" disabled>Left</button>
                                    <button id="Right2" disabled>Right</button>
                                    <button id="Iso2" disabled>Iso</button>
                                </div>
                            </td>
                        </tr>

                        <tr>
                            <td style="border:none;">
                            </td>
                            <td style="border:none;">
                                <label>Compliance<input id='complianceSourceBCB' type='checkbox' disabled></label>
                                <label>Check All<input id='checkAllSourceBCB' type='checkbox' onclick='checkAllCBClick(this, "modelTree2");'
                                        checked disabled></label>
                            </td>
                        </tr>
                    </table>
                </div>
            </td>
        <tr>
            <td style="border:none;">
                <label>Check Case <select id="checkCaseSelect"></select></label> <br>
                <label>Comparison <input id='comparisonCB' type='checkbox' disabled></label>
            </td>
        </tr>

        </tr>
        <th colspan="2" style=" background-color: #333333;  height: 10%;">
        </th>
    </table>

    <script type="text/javascript">

        var xCheckStudioInterface1;
        var xCheckStudioInterface2;
        var checkCaseManager;
        var checkCaseFilesData;

        window.onload = function () {
            //delete checkResultsArray from local storage
            delete(localStorage["CheckResultArray"]);

            var checkButton = document.getElementById("checkButton");
            checkButton.onclick = function () {

                // show busy loader
                var busySpinner = document.getElementById("divLoading");
                busySpinner.className = 'show';

                sourceAComplianceCheckManager = undefined;
                sourceBComplianceCheckManager = undefined;
                comparisonCheckManager = undefined;

                var checkCaseSelect = document.getElementById("checkCaseSelect");
                if (checkCaseSelect.value === "None") {

                    // hide busy spinner
                    busySpinner.classList.remove('show');

                    alert("Please select check case from list.")
                    return;
                }

                // check if any check case type is selected
                var comparisonCB = document.getElementById("comparisonCB");
                var complianceSourceACB = document.getElementById("complianceSourceACB");
                var complianceSourceBCB = document.getElementById("complianceSourceBCB");
                if (!comparisonCB.checked &&
                    !complianceSourceACB.checked &&
                    !complianceSourceBCB.checked) {
                    // hide busy spinner
                    busySpinner.classList.remove('show');

                    alert("No selected check type found. Please select check type.")
                    return;
                }

                //var checkMethod;
                for (var i = 0; i < checkCaseManager.CheckCase.CheckTypes.length; i++) {
                    var checkType = checkCaseManager.CheckCase.CheckTypes[i];

                    var comparisonCB = document.getElementById('comparisonCB');
                    if (comparisonCB.checked &&
                        checkType.Name.toLowerCase() === "comparison" &&
                        xCheckStudioInterface1 &&
                        xCheckStudioInterface2 &&
                        checkType.SourceAType.toLowerCase() === xCheckStudioInterface1.SourceType.toLowerCase() &&
                        checkType.SourceBType.toLowerCase() === xCheckStudioInterface2.SourceType.toLowerCase()) {
                        // checkMethod = checkType.Name;
                        // break;
                        if (!comparisonCheckManager) {
                            comparisonCheckManager = new CheckManager();
                            comparisonCheckManager.performCheck(xCheckStudioInterface1.sourceProperties,
                                xCheckStudioInterface2.sourceProperties,
                                checkType,
                                true,
                                undefined);
                        }
                    }
                    else {
                        if (xCheckStudioInterface1) {
                            var complianceSourceACB = document.getElementById("complianceSourceACB");
                            if (checkType.Name.toLowerCase() === "compliance" || checkType.Name.toLowerCase() === "compliancesourcea")
                            if(checkType.SourceAType.toLowerCase() === xCheckStudioInterface1.SourceType.toLowerCase() &&
                                complianceSourceACB.checked) {
                                if (!sourceAComplianceCheckManager) {
                                    sourceAComplianceCheckManager = new CheckManager();
                                    sourceAComplianceCheckManager.performCheck(xCheckStudioInterface1.sourceProperties,
                                        undefined,
                                        checkType,
                                        false,
                                        xCheckStudioInterface1);
                                }
                            }
                        }

                        if (xCheckStudioInterface2) {
                            var complianceSourceBCB = document.getElementById("complianceSourceBCB");
                            if (checkType.Name.toLowerCase() === "compliance" || checkType.Name.toLowerCase() === "compliancesourceb")
                            if(checkType.SourceAType.toLowerCase() === xCheckStudioInterface2.SourceType.toLowerCase() &&
                                complianceSourceBCB.checked) {
                                if (!sourceBComplianceCheckManager) {

                                    sourceBComplianceCheckManager = new CheckManager();
                                    sourceBComplianceCheckManager.performCheck(xCheckStudioInterface2.sourceProperties,
                                        undefined,
                                        checkType,
                                        false,
                                        xCheckStudioInterface2);
                                }
                            }
                        }
                    }
                }
                //jsonObj = JSON.stringify(xCheckStudioInterface1.sourceProperties, null, 2);
                // hide busy spinner
                busySpinner.classList.remove('show');

                var result = confirm("Check complete.\nView results?");
                if (result) {
                    // OK clicked
                    postData();
                    window.location = "/reviewModule.html";
                    return false;
                }
                else {
                    // Cancel clicked
                    sourceAComplianceCheckManager = undefined;
                    sourceBComplianceCheckManager = undefined;
                    comparisonCheckManager = undefined;
                }
            };

            var checkCaseSelect = document.getElementById("checkCaseSelect");
            checkCaseSelect.onchange = function () {
                var fileName;
                for (var i = 0; i < checkCaseFilesData.CheckCaseFileDataList.length; i++) {
                    var checkCaseFileData = checkCaseFilesData.CheckCaseFileDataList[i];
                    if (checkCaseFileData.CheckCaseName === this.value) {
                        fileName = checkCaseFileData.FileName;
                        break;
                    }
                }
                if (fileName === undefined) {
                    return;
                }

                // read check case data from XML checkcase data file
                checkCaseManager = new CheckCaseManager();
                checkCaseManager.readCheckCaseData(fileName);


                // enable source A load source buttton
                var loadDataSourceAButton = document.getElementById("dataSouresA");
                loadDataSourceAButton.disabled = false;
            }

            // read check cases files list
            checkCaseFilesData = new CheckCaseFilesData();
            checkCaseFilesData.readCheckCaseFiles();

            
        };

        function readExcelDataSource(file,
            dataSource,
            viewerContainer,
            modelTreeContainer) {

            let fileName = file.name;
            var fileExtension = xCheckStudio.Util.getFileExtension(fileName);

            document.getElementById(modelTreeContainer).innerHTML = ""
            document.getElementById(viewerContainer).innerHTML = ""
            if (!xCheckStudioInterface1) {
                xCheckStudioInterface1 = new xCheckStudio.xCheckStudioInterface(fileExtension);
                xCheckStudioInterface1.readExcelFileData(file, modelTreeContainer);

                // enable source A controls
                var sourceAComplianceCB = document.getElementById("complianceSourceACB");
                sourceAComplianceCB.disabled = false;

                var checkAllSourceACB = document.getElementById("checkAllSourceACB");
                checkAllSourceACB.disabled = false;

                // enable source B load data source button
                var loadDataSourceBButton = document.getElementById("dataSouresB");
                loadDataSourceBButton.disabled = false;
            }
            else {
                xCheckStudioInterface2 = new xCheckStudio.xCheckStudioInterface(fileExtension);
                xCheckStudioInterface2.readExcelFileData(file, modelTreeContainer);

                // enable source B controls
                var sourceBComplianceCB = document.getElementById("complianceSourceBCB");
                sourceBComplianceCB.disabled = false;

                var checkAllSourceBCB = document.getElementById("checkAllSourceBCB");
                checkAllSourceBCB.disabled = false;

                var comparisonCB = document.getElementById("comparisonCB");
                comparisonCB.disabled = false;
            }

            document.getElementById("checkButton").disabled = false;
        }


        function postData(url, method) {
            // remove post data js files from server from earlier check results, if any
            $.ajax({
                data: '',
                url: 'postData/postDataCleaner.php',
                method: 'POST', // or GET
                async: false,
                success: function (msg) {
                    //alert('Post Data files deleted');
                }
            });

            // post comparison data
            if (comparisonCheckManager) {
                $.ajax({
                    url: 'postData/comparisonCheckpostDataWriter.php',
                    type: "POST",
                    async: false,
                    data: { "ComparisonCheckManager": JSON.stringify(comparisonCheckManager) },
                    success: function (data) {
                        //alert("success");
                        //$("#result").html(data);
                    }
                });
            }

            // post source A compliance data
            if (sourceAComplianceCheckManager) {
                $.ajax({
                    url: 'postData/sourceAComplianceDataWriter.php',
                    type: "POST",
                    async: false,
                    data: { "SourceAComplianceCheckManager": JSON.stringify(sourceAComplianceCheckManager) },
                    success: function (data) {
                        //alert("success");
                        //$("#result").html(data);
                    }
                });
            }

            // post source B compliance data
            if (sourceBComplianceCheckManager) {
                $.ajax({
                    url: 'postData/sourceBComplianceDataWriter.php',
                    type: "POST",
                    async: false,
                    data: { "SourceBComplianceCheckManager": JSON.stringify(sourceBComplianceCheckManager) },
                    success: function (data) {
                        //alert("success");
                        //$("#result").html(data);
                    }
                });
            }
            
            // post source A viewer data
            if (xCheckStudioInterface1) {
                if (xCheckStudioInterface1.SourceType.toLowerCase() === "xml") {
                    //virewer container Data
                    var viewerOptions = [];
                    viewerOptions.push(xCheckStudioInterface1._firstViewer._params.containerId);
                    viewerOptions.push(xCheckStudioInterface1._firstViewer._params.endpointUri);

                    $.ajax({
                        url: 'postData/sourceAViewerDataWriter.php',
                        type: "POST",
                        async: false,
                        data: { "SourceAViewerData": JSON.stringify(viewerOptions) },
                        success: function (data) {
                            //alert("success");
                            //$("#result").html(data);
                        }
                    });


                    // postnode id and component data relation
                    if (xCheckStudioInterface1.nodeIdVsComponentData) {
                        $.ajax({
                            url: 'postData/sourceANodeIdVsComponentDataWriter.php',
                            type: "POST",
                            async: false,
                            data: { "SourceANodeIdVsComponentData": JSON.stringify(xCheckStudioInterface1.nodeIdVsComponentData) },
                            success: function (data) {
                                //alert("success");
                                //$("#result").html(data);
                            }
                        });
                    }

                    if (xCheckStudioInterface1.componentIdVsComponentData) {
                        $.ajax({
                            url: 'postData/sourceAComponentIdVsComponentDataWriter.php',
                            type: "POST",
                            async: false,
                            data: { "sourceAComponentIdVsComponentData": JSON.stringify(xCheckStudioInterface1.componentIdVsComponentData) },
                            success: function (data) {
                                //alert("success");
                                //$("#result").html(data);
                            }
                        });
                    }
                }

                else if (xCheckStudioInterface1.SourceType.toLowerCase() === "xls") {
                    $.ajax({
                        url: 'postData/SourceASheetDataWriter.php',
                        type: "POST",
                        async: false,
                        data: { "SourceASheetData": JSON.stringify(xCheckStudioInterface1.excelReader.sourceDataSheet) },
                        success: function (data) {
                            //alert("success");
                            //$("#result").html(data);
                        }
                    });
                }

            }

            if (xCheckStudioInterface2) {
                if (xCheckStudioInterface2.SourceType.toLowerCase() === "xml") {
                    //virewer container Data
                    var viewerOptions = [];
                    viewerOptions.push(xCheckStudioInterface2._firstViewer._params.containerId);
                    viewerOptions.push(xCheckStudioInterface2._firstViewer._params.endpointUri);

                    $.ajax({
                        url: 'postData/sourceBViewerDataWriter.php',
                        type: "POST",
                        async: false,
                        data: { "SourceAViewerData": JSON.stringify(viewerOptions) },
                        success: function (data) {
                            //alert("success");
                            //$("#result").html(data);
                        }
                    });

                    // postnode id and component data relation
                    if (xCheckStudioInterface2.nodeIdVsComponentData) {
                        $.ajax({
                            url: 'postData/sourceBNodeIdVsComponentDataWriter.php',
                            type: "POST",
                            async: false,
                            data: { "SourceBNodeIdVsComponentData": JSON.stringify(xCheckStudioInterface2.nodeIdVsComponentData) },
                            success: function (data) {
                                //alert("success");
                                //$("#result").html(data);
                            }
                        });
                    }

                    if (xCheckStudioInterface2.componentIdVsComponentData) {
                        $.ajax({
                            url: 'postData/sourceBComponentIdVsComponentDataWriter.php',
                            type: "POST",
                            async: false,
                            data: { "sourceBComponentIdVsComponentData": JSON.stringify(xCheckStudioInterface2.componentIdVsComponentData) },
                            success: function (data) {
                                //alert("success");
                                //$("#result").html(data);
                            }
                        });
                    }
                }

                else if (xCheckStudioInterface2.SourceType.toLowerCase() === "xls") {
                    $.ajax({
                        url: 'postData/SourceBSheetDataWriter.php',
                        type: "POST",
                        async: false,
                        data: { "SourceBSheetData": JSON.stringify(xCheckStudioInterface2.excelReader.sourceDataSheet) },
                        success: function (data) {
                            //alert("success");
                            //$("#result").html(data);
                        }
                    });
                }
            }
        }

        function openTab(tabName) {
            var tabs = document.getElementsByClassName("containerTab");
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].style.display = "none";
            }

            document.getElementById(tabName).style.display = "block";
        }

        function checkAllCBClick(checkBox, modelTreeContainer) {

            var modelTreeContainerElement = document.getElementById(modelTreeContainer);
            var modelTreeHeaderDiv = modelTreeContainerElement.children[0];

            var modelBrowserTable = modelTreeContainerElement.children[1];

            var modelBrowserTableRows = modelBrowserTable.getElementsByTagName("tr");
            // var currentTable = modelTreeParentDiv.children[0];

            for (var i = 0; i < modelBrowserTableRows.length; i++) {
                var row = modelBrowserTableRows[i];

                var currentCheckBox = row.cells[0].children[0];
                if (!currentCheckBox) {
                    continue;
                }

                if (checkBox.checked === currentCheckBox.checked) {
                    continue;
                }

                currentCheckBox.checked = checkBox.checked;
                if (currentCheckBox.checked) {
                    var checkedComponent;

                    if (xCheckStudioInterface1) {
                        if (xCheckStudioInterface1.SourceType.toLowerCase() === "xml") {
                            checkedComponent = {
                                'Name': row.cells[1].textContent.trim(),
                                'MainComponentClass': row.cells[2].textContent.trim(),
                                'SubComponentClass': row.cells[3].textContent.trim(),
                                'Source': row.cells[4].textContent.trim(),
                                'Destination': row.cells[5].textContent.trim(),
                                'Owner': row.cells[6].textContent.trim()
                            };

                            if (checkBox.id === "checkAllSourceACB" &&
                                xCheckStudioInterface1 &&
                                !xCheckStudioInterface1._modelTree.selectedCompoentExists(row)) {
                                xCheckStudioInterface1._modelTree.selectedCompoents.push(checkedComponent);
                            }
                        }
                        else if (xCheckStudioInterface1.SourceType.toLowerCase() === "xls") {
                            checkedComponent = {
                                'Name': row.cells[1].textContent.trim(),
                                'Category': row.cells[2].textContent.trim(),
                                'ComponentClass': row.cells[3].textContent.trim(),
                                'Description': row.cells[4].textContent.trim()
                            };

                            if (checkBox.id === "checkAllSourceACB" &&
                                xCheckStudioInterface1 &&
                                !xCheckStudioInterface1.excelReader.excelModelBrowser.selectedCompoentExists(row)) {
                                xCheckStudioInterface1.excelReader.excelModelBrowser.selectedCompoents.push(checkedComponent);
                            }
                        }
                        
                    }
                    if (xCheckStudioInterface2) {
                        if (xCheckStudioInterface2.SourceType.toLowerCase() === "xml") {
                            checkedComponent = {
                                'Name': row.cells[1].textContent.trim(),
                                'MainComponentClass': row.cells[2].textContent.trim(),
                                'SubComponentClass': row.cells[3].textContent.trim(),
                                'Source': row.cells[4].textContent.trim(),
                                'Destination': row.cells[5].textContent.trim(),
                                'Owner': row.cells[6].textContent.trim()
                            };

                            if (checkBox.id === "checkAllSourceBCB" &&
                            xCheckStudioInterface2 &&
                                !xCheckStudioInterface2._modelTree.selectedCompoentExists(row)) {
                                    xCheckStudioInterface2._modelTree.selectedCompoents.push(checkedComponent);
                            }
                        }
                        else if (xCheckStudioInterface2.SourceType.toLowerCase() === "xls") {
                            checkedComponent = {
                                'Name': row.cells[1].textContent.trim(),
                                'Category': row.cells[2].textContent.trim(),
                                'ComponentClass': row.cells[3].textContent.trim(),
                                'Description': row.cells[4].textContent.trim()
                            };

                            if (checkBox.id === "checkAllSourceBCB" &&
                            xCheckStudioInterface2 &&
                                !xCheckStudioInterface2.excelReader.excelModelBrowser.selectedCompoentExists(row)) {
                                    xCheckStudioInterface2.excelReader.excelModelBrowser.selectedCompoents.push(checkedComponent);
                            }
                        }
                    }
                }
            }

            if (!checkBox.checked) {
                if (checkBox.id === "checkAllSourceACB" &&
                    xCheckStudioInterface1) {
                        if(xCheckStudioInterface1.SourceType.toLowerCase() === "xml")
                        {
                            xCheckStudioInterface1._modelTree.selectedCompoents = [];
                        }
                        else if(xCheckStudioInterface1.SourceType.toLowerCase() === "xls")
                        {
                            xCheckStudioInterface1.excelReader.excelModelBrowser.selectedCompoents = [];
                        }
                    
                }
                else if (checkBox.id === "checkAllSourceBCB" &&
                    xCheckStudioInterface2) {
                        if(xCheckStudioInterface2.SourceType.toLowerCase() === "xml")
                        {
                            xCheckStudioInterface2._modelTree.selectedCompoents = [];
                        }
                        else if(xCheckStudioInterface2.SourceType.toLowerCase() === "xls")
                        {
                            xCheckStudioInterface2.excelReader.excelModelBrowser.selectedCompoents = [];
                        }
                }
            }
        }

        function loadDataSource(event,
            dataSource,
            formId,
            viewerContainer,
            modelTreeContainer) {

            if (!checkCaseManager ||
                !checkCaseManager.CheckCase) {
                alert("CheckCaseManager not found.");
                document.getElementById(formId).reset();
                return;
            }

            let selectedFiles = document.getElementById(dataSource).files;
            let selectedFilesCount = selectedFiles.length;
            if (selectedFilesCount == 0) {
                document.getElementById(formId).reset();
                return;
            }

            var file = event.target.files[0];
            let fileName = file.name;
            var fileExtension = xCheckStudio.Util.getFileExtension(fileName);

            //*******
            localStorage.setItem(dataSource, fileName);
            //*******

            if (fileExtension.toLowerCase() === "xml" || fileExtension.toLowerCase() === "rvm") {
                var busySpinner = document.getElementById("divLoading");
                busySpinner.className = 'show';

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "uploads/uploadfiles.php", true);
                xhr.onload = function (event) {
                    alert("The server says: " + event.target.response);
                    if (loadModel(dataSource, viewerContainer, modelTreeContainer)) {
                        document.getElementById(dataSource).disabled = true;
                    }
                    else {
                        document.getElementById(formId).reset();
                    }

                    busySpinner.classList.remove('show')
                };
                var formData = new FormData(document.getElementById(formId));
                xhr.send(formData);
            }
            else if (fileExtension.toLowerCase() === "xls") {
                {
                    readExcelDataSource(file,
                        dataSource,
                        viewerContainer,
                        modelTreeContainer);
                }
            }
        }

        function loadModel(dataSource, viewerContainer, modelTreeContainer) {

            if (!checkCaseManager ||
                !checkCaseManager.CheckCase) {
                alert("CheckCaseManager not found.");
                return false;
            }
            let selectedFiles = document.getElementById(dataSource).files;
            let selectedFilesCount = selectedFiles.length;

            let fileName = selectedFiles[0].name;
            var fileExtension = xCheckStudio.Util.getFileExtension(fileName);

            var sourceAType;
            var sourceBType;
            for (var i = 0; i < checkCaseManager.CheckCase.CheckTypes.length; i++) {
                var checkType = checkCaseManager.CheckCase.CheckTypes[i];
                if (checkType.Name.toLowerCase() === "comparison") {
                    sourceAType = checkType.SourceAType;
                    sourceBType = checkType.SourceBType;
                }
                else if (checkType.Name.toLowerCase() === "compliance") {
                    sourceAType = checkType.SourceAType;
                }
            }

            if (viewerContainer === "viewerContainer1") {
                if (!sourceAType ||
                    sourceAType.toLowerCase() !== fileExtension.toLowerCase()) {
                    alert("Data source type doesn't match with check case.");
                    return false;
                }
            }
            else if (viewerContainer === "viewerContainer2") {
                if (!sourceBType ||
                    sourceBType.toLowerCase() !== fileExtension.toLowerCase()) {
                    alert("Data source type doesn't match with check case.");
                    return false;
                }
            }

            fileName = fileName.substring(0, fileName.lastIndexOf('.'));
            fileName += '.scs';

            var uri = "uploads/scs/" + fileName;

            xCheckStudio.Util.fileExists(uri).then(function (success) {
                if (success) {
                    //alert("File found to load.");
                    viewerOptions = {
                        containerId: viewerContainer,
                        endpointUri: uri,
                        modelTree: modelTreeContainer
                    };

                    if (viewerContainer === "viewerContainer1") {
                        xCheckStudioInterface1 = new xCheckStudio.xCheckStudioInterface(fileExtension);
                        xCheckStudioInterface1.setupViewer(viewerOptions, true);

                        // enable source A controls
                        var checkAllSourceACB = document.getElementById("checkAllSourceACB");
                        checkAllSourceACB.disabled = false;

                        var sourceAComplianceCB = document.getElementById("complianceSourceACB");
                        sourceAComplianceCB.disabled = false;

                        var sourceAFrontView = document.getElementById(sourceAFrontId);
                        sourceAFrontView.disabled = false;
                        var sourceABackView = document.getElementById(sourceABackId);
                        sourceABackView.disabled = false;
                        var sourceATopView = document.getElementById(sourceATopId);
                        sourceATopView.disabled = false;
                        var sourceABottomView = document.getElementById(sourceABottomId);
                        sourceABottomView.disabled = false;
                        var sourceALeftView = document.getElementById(sourceALeftId);
                        sourceALeftView.disabled = false;
                        var sourceARightView = document.getElementById(sourceARightId);
                        sourceARightView.disabled = false;
                        var sourceAIsoView = document.getElementById(sourceAIsoId);
                        sourceAIsoView.disabled = false;

                        // enable source B load data source button
                        var loadDataSourceBButton = document.getElementById("dataSouresB");
                        loadDataSourceBButton.disabled = false;
                    }
                    else if (viewerContainer === "viewerContainer2") {
                        xCheckStudioInterface2 = new xCheckStudio.xCheckStudioInterface(fileExtension);
                        xCheckStudioInterface2.setupViewer(viewerOptions, false);

                        // enable source B controls
                        var sourceBComplianceCB = document.getElementById("complianceSourceBCB");
                        sourceBComplianceCB.disabled = false;

                        var checkAllSourceBCB = document.getElementById("checkAllSourceBCB");
                        checkAllSourceBCB.disabled = false;

                        var sourceBFrontView = document.getElementById(sourceBFrontId);
                        sourceBFrontView.disabled = false;
                        var sourceBBackView = document.getElementById(sourceBBackId);
                        sourceBBackView.disabled = false;
                        var sourceBTopView = document.getElementById(sourceBTopId);
                        sourceBTopView.disabled = false;
                        var sourceBBottomView = document.getElementById(sourceBBottomId);
                        sourceBBottomView.disabled = false;
                        var sourceBLeftView = document.getElementById(sourceBLeftId);
                        sourceBLeftView.disabled = false;
                        var sourceBRightView = document.getElementById(sourceBRightId);
                        sourceBRightView.disabled = false;
                        var sourceBIsoView = document.getElementById(sourceBIsoId);
                        sourceBIsoView.disabled = false;

                        var comparisonCB = document.getElementById("comparisonCB");
                        comparisonCB.disabled = false;
                    }

                }
                else {
                    alert("File not found to load.");
                    return false;
                }
            });

            //enable check Button
            document.getElementById("checkButton").disabled = false;
            return true;
        }

        function clearData() {
            window.location.reload();
        }

    </script>
</body>

</html>